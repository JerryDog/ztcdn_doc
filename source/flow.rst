


流量查询
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

查询时间区间内的指定域名的日流量，
需要先通过身份验证获取 Token，再带上这个 Token 去执行刷新动作。


API规范
--------------------------

认证服务API入口与API列表如下：


    * API入口: http://cdnapi.ztgame.com.cn
    * API列表:

+------------------+------------------------------+------------+--------------------------------+
|  资源            |  操作                        |  HTTP方法  |  URI路径                       |
+==================+==============================+============+================================+
|  Flow (流量)     |  :ref:`flow`                 |  POST      |  /cdn_api/flow                 |
+------------------+------------------------------+------------+--------------------------------+


流量查询
--------------------------------------

.. _keystone-get-token:

先认证并获取新令牌(已可用), 使用该令牌执行预存动作

+------------+-------------------+---------------+
|  HTTP方法  |  URI路径          |  描述         |
+============+===================+===============+
|  POST      |  /cdn_api/flow    |  流量统计     |
+------------+-------------------+---------------+

请求参数

+-----------------------+----------+-----------------------------------------------------------------------------+
|  字段名               |  类型    |  描述                                                                       |
+=======================+==========+=============================================================================+
|  domainName           |  string  |  指定需要查询的域名                                                         |
+-----------------------+----------+-----------------------------------------------------------------------------+
|  start                |  string  |  指定查询的开始时间，日期格式采用 %Y-%m-%d 格式                             |
+-----------------------+----------+-----------------------------------------------------------------------------+
|  end                  |  string  |  指定查询的结束时间，日期格式采用 %Y-%m-%d 格式                             |
+-----------------------+----------+-----------------------------------------------------------------------------+

请求样例

::

    
    curl  -s \
          -X POST `http://cdnapi.ztgame.com.cn/cdn_api/flow` \
          -H 'Content-Type: application/json' \
          -H 'X-Auth-Token: {token_id}' \
          -d '{
                 "domainName": "test.ztgame.com",
                 "start": "2015-11-01",
                 "end": "2015-11-23"
             }'

返回参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  zt_api           |  dict       |  包含了ret, msg, reqId, successRate等信息                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ret              |  int        |  返回了请求结果状态，0 为此次请求成功，非0则失败                        |
+-------------------+-------------+-------------------------------------------------------------------------+
|  msg              |  string     |  返回了请求结果                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+
|  flowValue        |  list       |  流量的 daily 列表， 包含键 time 与值 value                             |
+-------------------+-------------+-------------------------------------------------------------------------+


返回样例

::


        HTTP/1.0 200 OK
        Content-Type: application/json
        Content-Length: 134
        Server: Werkzeug/0.10.4 Python/2.7.5
        Date: Tue, 24 Nov 2015 11:39:11 GMT

        {
            "zt_api": {
                "msg": "OK", 
                "ret": 0, 
                "flowValue": [
                    {
                        "time": "2015-11-18", 
                        "value": 0.0
                    }, 
                    {
                        "time": "2015-11-19", 
                        "value": 0.0
                    }, 
                    {
                        "time": "2015-11-20", 
                        "value": 0.0
                    }, 
                    {
                        "time": "2015-11-21", 
                        "value": 0.0
                    }, 
                    {
                        "time": "2015-11-22", 
                        "value": 0.0
                    }, 
                    {
                        "time": "2015-11-23", 
                        "value": 0.0
                    }
              ]
           }
       }

