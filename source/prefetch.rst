


预缓存
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

预取文件，必须是已备案的域名，需要先通过身份验证获取 Token，再带上这个 Token 去执行刷新动作。


API规范
--------------------------

认证服务API入口与API列表如下：


    * API入口: http://cdnapi.ztgame.com.cn
    * API列表:

+------------------+------------------------------+------------+--------------------------------+
|  资源            |  操作                        |  HTTP方法  |  URI路径                       |
+==================+==============================+============+================================+
|  Prefetch (预存) |  :ref:`prefetch`   |  POST      |  /cdn_api/prefetch             |
+------------------+------------------------------+------------+--------------------------------+


预缓存
--------------------------------------

.. _keystone-get-token:

先认证并获取新令牌(已可用), 使用该令牌执行预存动作

+------------+-------------------+---------------+
|  HTTP方法  |  URI路径          |  描述         |
+============+===================+===============+
|  POST      |  /cdn_api/prefetch|  预缓存       |
+------------+-------------------+---------------+

请求参数

+-----------------------+----------+-----------------------------------------------------------------------------+
|  字段名               |  类型    |  描述                                                                       |
+=======================+==========+=============================================================================+
|  urls                 |  list    |  需要预存的文件 url 列表，一次不能超过10条，需要是同一个域名                |
+-----------------------+----------+-----------------------------------------------------------------------------+

请求样例

::

    
    curl  -s \
          -X POST `http://cdnapi.ztgame.com.cn/cdn_api/prefetch` \
          -H 'Content-Type: application/json' \
          -H 'X-Auth-Token: {token_id}' \
          -d '{
                 "urls": [
                     "http://hewenchina.com/static/images/news1.jpg",
                     "http://hewenchina.com/static/images/news2.jpg",
                     "http://hewenchina.com/static/images/news3.jpg",
                 ]
             }'

返回参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  zt_api           |  dict       |  包含了ret, msg, reqId, successRate等信息                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ret              |  int        |  返回了请求结果状态，0 为此次请求成功，非0则失败                        |
+-------------------+-------------+-------------------------------------------------------------------------+
|  msg              |  string     |  返回了请求结果                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+
|  reqId(重要)      |  uuid       |  返回的请求ID，用户需要根据请求ID去查询此次预存的状态                   |
+-------------------+-------------+-------------------------------------------------------------------------+


返回样例

::


        HTTP/1.0 200 OK
        Content-Type: application/json
        Content-Length: 134
        Server: Werkzeug/0.10.4 Python/2.7.5
        Date: Tue, 24 Nov 2015 11:39:11 GMT

        {
            "zt_api": {
                "msg": "OK", 
                "reqId": "fa97b5d1-929f-11e5-b504-e03f4978b2ff", 
                "ret": 0, 
                "success_rate": 100.0
            }
        }

