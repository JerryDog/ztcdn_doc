


查询预存及刷新缓存状态
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

根据刷新缓存和预缓存返回的 reqId，查询状态。
需要先通过身份验证获取 Token，再带上这个 Token 去执行刷新动作。



API规范
--------------------------

认证服务API入口与API列表如下：


    * API入口: http://cdnapi.ztgame.com.cn
    * API列表:

+------------------+------------------------------+------------+--------------------------------+
|  资源            |  操作                        |  HTTP方法  |  URI路径                       |
+==================+==============================+============+================================+
|  Prefetch (预存) |  :ref:`keystone-get-token`   |  GET       |  /cdn_api/req_status/{reqId}   |
+------------------+------------------------------+------------+--------------------------------+


获取任务状态
--------------------------------------

.. _keystone-get-token:

先认证并获取新令牌(已可用), 使用该令牌执行预存动作

+------------+-----------------------------+---------------+
|  HTTP方法  |  URI路径                    |  描述         |
+============+=============================+===============+
|  GET       |  /cdn_api/req_status/{reqId}|  获取状态     |
+------------+-----------------------------+---------------+

请求参数

+-----------------------+----------+-----------------------------------------------------------------------------+
|  字段名               |  类型    |  描述                                                                       |
+=======================+==========+=============================================================================+
|  reqId                |  uuid    |  根据之前提交预缓存、刷新任务获取的 reqId                                   |
+-----------------------+----------+-----------------------------------------------------------------------------+

请求样例

::

    
    curl  -s \
          -X GET `http://cdnapi.ztgame.com.cn/cdn_api/req_status/{reqId}`_ \
          -H 'X-Auth-Token: {token_id}' 


返回参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  task             |  dict       |  包含了ret, msg, reqId, successRate, taskStatus等信息                   |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ret              |  int        |  返回了请求结果状态，0 为此次请求成功，非0则失败                        |
+-------------------+-------------+-------------------------------------------------------------------------+
|  msg              |  string     |  返回了请求结果                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+
|  projectId        |  uuid       |  返回该任务所属的项目的 ID                                              |
+-------------------+-------------+-------------------------------------------------------------------------+
|  taskContent      |  url        |  返回该任务请求的内容                                                   |
+-------------------+-------------+-------------------------------------------------------------------------+
|  taskCreateAt     |  datetime   |  返回该任务的创建时间                                                   |
+-------------------+-------------+-------------------------------------------------------------------------+
|  taskDoneAt       |  datetime   |  返回该任务的完成时间                                                   |
+-------------------+-------------+-------------------------------------------------------------------------+
|  taskId           |  uuid       |  返回该任务的 reqId                                                     |
+-------------------+-------------+-------------------------------------------------------------------------+
|  taskStatus       |  string     |  返回该任务的状态                                                       |
+-------------------+-------------+-------------------------------------------------------------------------+
|  taskType         |  string     |  返回该任务的类型，0：刷新文件，1：刷新目录，2：预缓存                  |
+-------------------+-------------+-------------------------------------------------------------------------+
|  taskUser         |  string     |  返回执行该任务的用户                                                   |
+-------------------+-------------+-------------------------------------------------------------------------+


返回样例

::


        HTTP/1.0 200 OK
        Content-Type: application/json
        Content-Length: 134
        Server: Werkzeug/0.10.4 Python/2.7.5
        Date: Tue, 24 Nov 2015 11:39:11 GMT

        {
            "task": {
                "projectId": "74d4bda6aa1c466d8cb1f2b8eac79567", 
                "taskContent": "htttp://jay.ztgame.com/static/images/news.jpg,http://jay.ztgame.com/static/image", 
                "taskCreateAt": null, 
                "taskDoneAt": null, 
                "taskId": "fa97b5d1-929f-11e5-b504-e03f4978b2ff", 
                "taskStatus": "RUN", 
                "taskType": "0", 
                "taskUser": "admin"
            }
        }
